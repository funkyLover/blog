---
layout: post
title: "2019-07-02"
date: 2019-07-02
tags: [front-end, 小程序]
comments: true
share: true
---

> [2019-07-04]小程序vh适配 <br>
> [2019-07-03]浏览器跨域: 简单请求和非简单请求 <br>
> [2019-07-02]线上出bug, 通过报错信息及本地source-map定位问题 <br>

##### [2019-07-04]小程序vh适配

对于单屏页面的适配方案, 可以通过vh来解决

设计以iphone7与iphone X为标准输出标注稿

小程序判断是否为全面屏, 字号不做适配, 但涉及布局的margin/padding等, 按需切换成vh/vw

```css
/* 怕出现不支持vh的设备, 采用了较为稳妥的方式 */
.title {
    margin-top: 10rpx;
    margin-top: 0.74vh; /* 10 / 13.34 */
}

.fullscreen .title {
    margin-top: 15rpx;
    margin-top: 1.12vh; /* 1.12 / 13.34 */
}
```

这样可以适配绝大部分主流屏幕, 包括早期虽然屏幕宽高比为9:16, 但有虚拟按键的安卓机

如果还要适配iphone4(为你默哀), 则还需要设计输出小屏手机的标注稿

##### [2019-07-03]浏览器跨域: 简单请求和非简单请求

当前端进行跨域请求时, 浏览器针对简单请求和非简单请求有不同的处理

如果为简单请求, 浏览器会把直接发送, 而如果是非简单请求, 浏览器会先发一个`OPTIONS`请求确认服务器支持`CORS`, OPTIONS请求成功之后才会帮我们发出真正的业务请求

而只要满足以下所有条件即为`简单请求`

1. 请求方式只能是: GET, POST, HEAD
1. 不得人为设置下面集合以外的HTTP请求头字段
    - Accept, Accept-Language, Content-Language, Content-Type, DPR, Downlink, Save-Date, Viewport-Width, Width
1. Content-Type只能取以下值
    - application/x-www-form-urlencoded, multipart/form-data, text/plain
1. 请求中的任意`XMLHttpRequestUpload`对象均没有注册任何事件监听器
1. 请求中没有使用`ReadableStream`对象

##### [2019-07-02]线上出bug, 通过报错信息及本地source-map定位问题

前端代码上线时不能把source-map同时上线, 因为source-map里包含了源码的信息, 只要通过工具就可以还原源码, 造成源码泄露

一般而言都需要搭配监控体系来完成生产, 生产环境报错会记录到监控后台, 获取到错误堆栈信息再通过[source-map](https://www.npmjs.com/package/source-map)的api即可定位源码信息

大家可以查阅[《线上出bug了？别怕，这么定位！》](https://juejin.im/post/5c8bbb30f265da2dc539008c)这篇文章后半部分内容.
