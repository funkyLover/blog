---
layout: post
title: "2019-08-02"
date: 2019-08-02
tags: [node, 小程序]
comments: true
share: true
---

> [2019-08-04]js生成随机字符串 <br>
> [2019-08-02]小程序更新api使用 <br>
> [2019-08-02]让Nodejs请求是绕开本地hosts文件(如mac/linunx下`/etc/hosts`) <br>

##### [2019-08-04]js生成随机字符串

from https://www.cnblogs.com/makan/p/4850071.html

```js
Math.random().toString(36).substr(2);
```

##### [2019-08-02]小程序更新api使用

来自[《小程序的强制更新机制》](http://yuanhehe.cn/2018/03/30/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%9A%84%E5%BC%BA%E5%88%B6%E6%9B%B4%E6%96%B0%E6%9C%BA%E5%88%B6/)

```js
// wx.getUpdateManager 在 1.9.90 才可用，请注意兼容
const updateManager = wx.getUpdateManager()
 
updateManager.onCheckForUpdate(function (res) {
  // 请求完新版本信息的回调
  console.log(res.hasUpdate)
})
 
updateManager.onUpdateReady(function () {
  wx.showModal({
    title: '更新提示',
    content: '新版本已经准备好，是否马上重启小程序？',
    success: function (res) {
      if (res.confirm) {
        // 新的版本已经下载好，调用 applyUpdate 应用新版本并重启
        updateManager.applyUpdate()
      }
    }
  })
})
 
updateManager.onUpdateFailed(function () {
  // 新的版本下载失败
})
```

##### [2019-08-02]让Nodejs请求是绕开本地hosts文件(如mac/linunx下`/etc/hosts`)

from [nodejs-bypass-linux-hosts-file](https://stackoverflow.com/questions/44335176/nodejs-bypass-linux-hosts-file)

**注意**: 未在windows上进行测试

```bash
$ cat /etc/hosts
<snip>
127.0.0.1 google.com
$ ping google.com
PING google.com (127.0.0.1) 56(84) bytes of data.
```

```js
const dns = require('dns')

// This will use the hosts file.
dns.lookup('google.com', function (err, res) {
  console.log('This computer thinks Google is located at: ' + res)
})

dns.resolve4('google.com', function (err, res) {
  console.log('A real IP address of Google is: ' + res[0])
})
```
