---
layout: post
title: "2020-03-11"
date: 2020-03-11
tags: [vscode, wx, js]
comments: true
share: true
---

> [2020-03-20]Mac 端企业微信工作应用页面代理 <br> > [2020-03-20]企业微信 JSSDK wx.agentConfig is not a function <br> > [2020-03-19]输出 `Error` 得到结果 `{“isTrusted”:true}` 而没有实际错误信息 <br> > [2020-03-13][转载]css 字体相关内容 <br> > [2020-03-11]vscode 配合 webapck.resolve 进行路径提示

##### [2020-03-20]Mac 端企业微信工作应用页面代理

目前工作台应用暂时没有办法在 Mac 端企业微信进行调试, 原因就是 Webview(UIWebview or WKWebview)都无法设置代理

1. 设置企业微信代理 https://work.weixin.qq.com/help?doc_id=13888, 只在第一个请求有效
1. proxifier 全局代理, 不知道为啥工作台应用页面的请求就是抓不到, 难道我打开方式不对?
1. 设置系统代理 - 可行, 具体看下方

首先在新建一个 pac 文件, 内容如下

```js
function FindProxyForURL(url, host) {
  if (url.indexOf("target.host.com") !== -1) {
    // 这里要替换成需要代理的目标 host
    return "PROXY 127.0.0.1:8000"; // 转发到代理服务器
  }

  return "DIRECT"; // 其他请求正常发出
  // return "PROXY 127.0.0.1:xxxxx"; // 或转发到系统代理
}
```

然后启动一个静态服务器来 server 上述的 pac 文件, 并修改系统代理

![路径提示](/images/2020-03/3.png)

这样打开工作台应用, 就可以使用本地服务器进行调试了

而移动端企业微信的话, 因为移动端可以设置手机的网络代理

可以比较方便实现上述述求

而如果不需要使用 `agentConfig` 及其他企业微信特有的 JSSDK 接口的话, 也可以在微信开发者工具中调试

另外想到不知道可不可以通过 `远程开发` 的手段, 在开发测试服务器上直接以开发模式(`npm run dev`)运行

然后 vscode 通过 `remote ssh` 等远程开发工具直连开发测试机实时修改代码调试

而由于是线上服务器, 就不需要设置代理了, 当然开发环境的维护成本就上去了

##### [2020-03-20]企业微信 JSSDK wx.agentConfig is not a function

可以看下这个[问题#wx.agentConfig is not a function](https://developers.weixin.qq.com/community/develop/doc/000a8a7d1000e0c7de89a14c456c00)

里面提到不能把文件下载到自己的服务器进行下发, 必须使用 `http://res.wx.qq.com/open/js/jweixin-1.2.0.js`

另外[JSSDK 基础接口文档](https://work.weixin.qq.com/api/doc/90000/90136/90515)中也提到了

`agentConfig仅在企业微信2.5.0及以后版本支持，微信侧不支持（微信开发者工具也不支持）。`

调试过程中发现如果参数错误(如签名错误)好像也会报这个错

##### [2020-03-19]输出 `Error` 得到结果 `{“isTrusted”:true}` 而没有实际错误信息

今天在调试一个页面问题, 试着把错误对象通过 `alert` 打到页面上

```js
alert(JSON.stringify(err)); // 因为是在调试企业微信工作台应用页面, 目前来看好像不支持控制台调试 - -, 唯有麻烦一点了.
```

发现获取的结果是只有简单的 `{“isTrusted”:true}`, 而非具体的错误信息

去搜了一下, 原来 `JSON.stringify` 只能处理可被枚举的属性, 但是 `Error` 对象中的错误信息都是不可枚举的(`inenumerable`)

所以直接 `JSON.stringify` 的话会丢失所有错误信息

可以这样来处理

```js
JSON.stringify(err, ["message", "arguments", "type", "name"]);
```

##### [2020-03-13][转载]css 字体相关内容

其实这部分内容大部分整理自[segmentfault](https://segmentfault.com/)

我也在 segmentfault 上收藏了, 但是每次再去找的时候还是觉得比较麻烦, 所以还是在自己的 blog 上记录一下

[如何优雅的选择字体(font-family)](https://segmentfault.com/a/1190000006110417)

[CSS 字体设置的几个问题？](https://segmentfault.com/q/1010000003037766)

##### [2020-03-11]vscode 配合 webapck.resolve 进行路径提示并能跳转等

之前曾记录过[vscode 配置 jsconfig.json 支持 webpack alias resolver](http://blog.ahui.me/notes/2019-05-10/notes/#2019-05-25vscode%E9%85%8D%E7%BD%AEjsconfigjson%E6%94%AF%E6%8C%81webpack-alias-resolver)

通过配置 jsconfig (如果是 ts, 则是 tsconfig), 让 vscode 可以正常进行路径提示并进行代码跳转, 但美中不足的是, 只有 `.js` 文件能被正常提示

后面发现还有 `path-intellisense` 同样也可以配置路径映射

```json
{
  "path-intellisense.mappings": {
    "@component": "${workspaceRoot}/component"
  }
}
```

效果如下

![路径提示](/images/2020-03/1.png)

但还是没有解决最终解决问题, 因为配置 `path-intellisense` 后并不能进行代码跳转, 但同时配置 `path-intellisense` 和 `jsconfig/tsconfig`时, 在具体的 `import` 中好像又只有后者会生效

效果如下

![路径提示](/images/2020-03/2.png)

目前还没找到真正解决这个问题的方法

**未完待续.....**
