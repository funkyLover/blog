---
layout: post
title: "2020-04-02"
date: 2020-04-02
tags: [mysql, node]
comments: true
share: true
---

> [2020-04-03]使用 vue-class-component 定义 vue 组件时, 当 data 数据中初始值为 undefined 时, 对应属性无法正常运作 <br>
> [2020-04-02]typeorm 连接 mysql 8.0 报错 Client does not support authentication protocol requested by server; <br>

##### [2020-04-03]使用 vue-class-component 定义 vue 组件时, 当 data 数据中初始值为 undefined 时, 对应属性无法正常运作

问题复现如下

```ts
export default class Foo extends Vue {
    foo: string | undefined = undefined;

    bar: string | undefined = '123';
}
```

使用 vue devtool 观察结果如下

![undefined](/images/2020-04/1.png)

可以看出 foo 属性没有被正确处理

小伙伴找到这个 [issue](https://github.com/vuejs/vue-class-component/issues/39)

看讨论来看这个 feature 而不是 bug - -!

按 issue 上的讨论来进行修改

```ts
export default class Foo extends Vue {
    data() {
      return {
        foo: undefined
      }
    };

    bar: string | undefined = '123';
}
```

使用 vue devtool 观察结果如下, foo 属性没有被正确处理

![data hook](/images/2020-04/2.png)

不过这样改并不完善, 原因是使用 `data hook` 来初始化的属性, 并不能被 typescript 识别并处理, 当你使用改属性的时候会报错

```ts
export default class Foo extends Vue {
    data() {
      return {
        foo: undefined
      }
    };

    bar: string | undefined = '123';

    test(): void {
      console.log(this.foo); // 这里会报错找不到 foo 属性
    }
}
```

最终处理如下, 不过的确有点难看

```ts
export default class Foo extends Vue {
    data() {
      return {
        foo: undefined
      }
    };

    foo: string | undefined = undefined;

    bar: string | undefined = '123';

    test(): void {
      console.log(this.foo); // 不会报错
    }
}
```

##### [2020-04-02]typeorm 连接 mysql 8.0 报错 Client does not support authentication protocol requested by server;

使用 typeorm 连接 mysql 8.0 时, 会报错连不上, 原因大致是 目前 nodejs 的 mysql 的模块不支持 mysql 8.0 的默认的加密认证方式 (这里后续还需研究)

在 stackoverflow 上找到了解决方案, 直接上连接 https://stackoverflow.com/questions/50093144/mysql-8-0-client-does-not-support-authentication-protocol-requested-by-server

这里也直接贴下回答方便自己回答

```text
Execute the following query in MYSQL Workbench

ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'password'

Where root as your user localhost as your URL and password as your password

Then run this query to refresh privileges:

flush privileges;

Try connecting using node after you do so.

If that doesn't work, try it without @'localhost' part.
```
