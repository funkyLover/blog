---
layout: post
title: "2020-04-02"
date: 2020-04-02
tags: [mysql, node]
comments: true
share: true
---

> [2020-04-20]moment 实现后端常用的日期类型参数检查  <br> 
> [2020-04-14]typescript 重写类型声明文件中定义的 interface 属性类型  <br> 
> [2020-04-08]svg 转 font 使用时, 显示混乱或修改颜色时只有部分路径生效 <br> 
> [2020-04-03]使用 vue-class-component 定义 vue 组件时, 当 data 数据中初始值为 undefined 时, 对应属性无法正常运作 <br> 
> [2020-04-02]typeorm 连接 mysql 8.0 报错 Client does not support authentication protocol requested by server; <br>

##### [2020-04-20]moment 实现后端常用的日期类型参数检查

- 格式检查

后端接口检查参数, 对于日期参数限定格式为 `YYYY-MM-DD`, 在检查日期合法的同时, 也需要检查格式是否符合预期

简单用 moment 的 api 来实现

```js
moment(date, 'YYYY-MM-DD').format('YYYY-MM-DD') === date
```

- 日期大小检查

日期 A 是不是早于/晚于日期 B

```js
moment('2010-10-20').isBefore('2010-10-21');
```

##### [2020-04-14]typescript 重写类型声明文件中定义的 interface 属性类型

解决方案来自 https://stackoverflow.com/questions/41285211/overriding-interface-property-type-defined-in-typescript-d-ts-file

```ts
// type
interface A {
    x: string
}

export type B = Omit<A, 'x'> & { x: number };

// interface

interface A {
    x: string
}

interface B extends Omit<A, 'x'> {
  x: number
}
```

##### [2020-04-08]svg 转 font 使用时, 显示混乱或修改颜色时只有部分路径生效

在 iconmoon 上也能找到相关说明

原因是 svg 中并不是所有的元素都是 `fill` 方式填充的形状

**我对 svg 了解甚少**, 目前看来好像必须要把 `Stroke` 和 `Text` 一类的都转化成 `Fill` 才行

```xml
<g>
    <g>
        <circle stroke="#002300"></circle> <!-- 这里的元素在处理成 font 时可能会导致显示混乱 -->
        <path fill="#002300"></path>
        <path fill="#002300"></path>
    </g>
</g>
```

目前我是用 `Sketch` 来处理有问题的 svg, 只需要选中对应形状, 然后再`图层`(Layer)菜单选择`轮廓化`(Convert to Outlines), 然后导出处理过后的 svg 即可

如果你使用的是其他工具编辑 svg, 可以参考下对应的 [iconmoon 文档](https://icomoon.io/#docs/stroke-to-fill)的说明

```text
Converting Strokes & Text to Fills
The current version of the IcoMoon app ignores strokes when generating fonts or CSH files. But you can convert strokes to fills in different vector editing programs:

Adobe Illustrator
Select the shapes that you want to convert and then choose Object → Expand. You might need to choose Object → Expand Appearance before you can apply Object → Expand.

Ink Scape
Select the shapes that you want to convert and then choose Path → Stroke to Path.

Sketch
Select the shapes that you want to convert and choose Layer → Convert to Outlines
```

##### [2020-04-03]使用 vue-class-component 定义 vue 组件时, 当 data 数据中初始值为 undefined 时, 对应属性无法正常运作

问题复现如下

```ts
export default class Foo extends Vue {
  foo: string | undefined = undefined;

  bar: string | undefined = "123";
}
```

使用 vue devtool 观察结果如下

![undefined](/images/2020-04/1.png)

可以看出 foo 属性没有被正确处理

小伙伴找到这个 [issue](https://github.com/vuejs/vue-class-component/issues/39)

看讨论来看这个 feature 而不是 bug - -!

按 issue 上的讨论来进行修改

```ts
export default class Foo extends Vue {
  data() {
    return {
      foo: undefined,
    };
  }

  bar: string | undefined = "123";
}
```

使用 vue devtool 观察结果如下, foo 属性没有被正确处理

![data hook](/images/2020-04/2.png)

不过这样改并不完善, 原因是使用 `data hook` 来初始化的属性, 并不能被 typescript 识别并处理, 当你使用改属性的时候会报错

```ts
export default class Foo extends Vue {
  data() {
    return {
      foo: undefined,
    };
  }

  bar: string | undefined = "123";

  test(): void {
    console.log(this.foo); // 这里会报错找不到 foo 属性
  }
}
```

最终处理如下, 不过的确有点难看

```ts
export default class Foo extends Vue {
  data() {
    return {
      foo: undefined,
    };
  }

  foo: string | undefined = undefined;

  bar: string | undefined = "123";

  test(): void {
    console.log(this.foo); // 不会报错
  }
}
```

##### [2020-04-02]typeorm 连接 mysql 8.0 报错 Client does not support authentication protocol requested by server;

使用 typeorm 连接 mysql 8.0 时, 会报错连不上, 原因大致是 目前 nodejs 的 mysql 的模块不支持 mysql 8.0 的默认的加密认证方式 (这里后续还需研究)

在 stackoverflow 上找到了解决方案, 直接上连接 https://stackoverflow.com/questions/50093144/mysql-8-0-client-does-not-support-authentication-protocol-requested-by-server

这里也直接贴下回答方便自己回答

```text
Execute the following query in MYSQL Workbench

ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'password'

Where root as your user localhost as your URL and password as your password

Then run this query to refresh privileges:

flush privileges;

Try connecting using node after you do so.

If that doesn't work, try it without @'localhost' part.
```
