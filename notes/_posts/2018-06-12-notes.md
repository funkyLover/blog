---
layout: post
title: "2018-06-12"
date: 2018-06-12
tags: [webpack, js]
comments: true
share: true
---

> [18-06-22]微信h5页面, 如果阻止了touch事件的默认动作, 会导致微信不会出现长按识别二维码菜单 <br>
> [18-06-19]原生js如何删除一个元素上所有的`EventListener` <br>
> [18-06-12]使用webpack动态导入功能最终生成多个bundle时,如何指定异步bundle的url <br>

##### [18-06-22]微信h5页面, 如果阻止了touch事件的默认动作, 会导致微信不会出现长按菜单

经测试在安卓系统下会出现这种情况, 微信h5长按菜单说的是图片所示的菜单(截图于小米5)

![微信长按菜单](/images/2018-06/wx-contextmenu.png)

```js
document.getElementById('img').addEventListener('touchstart', (e) => {
  // 如果这里阻止默认行为, 会导致微信不能响应长按出现菜单
  e.preventDefault();
});
```


##### [18-06-19]原生js如何删除一个元素上所有的`EventListener`

在stackoverflow上找到的答案, 大致思路就是把复制那个元素, 然后用复制的元素替换掉旧的元素

需要注意的有两点, 一个是元素的子元素或内容很多时, 复制可能会耗费一定时间. 再来是这个操作只是删除了响应事件的目标DOM, 事实上事件处理回调函数的空间还是没有回收(如果形成闭包的话),容易造成内容泄露

```js
const oldEl = document.getElementById('el-id'),
const newEL = el.cloneNode(true);

oldEl.parentNode.replaceChild(newEL, oldEl);
```


##### [18-06-12]使用webpack动态导入功能最终生成多个bundle时,如何指定异步加载的路径

设置output.publicPath为目标路径,可以使用url或路径,在production build的时候可以设置为线上的cdn地址的,然后把打包完成的资源直接上传到cdn即可

```js
const config = {
  // ...
  output: {
    path: './dist', 
    filename: '[name].js',
    publicPath: 'https://my.cdn.com/assets/' // 最终bundleurl为 https://my.cdn.com/assets/[name].js
  }
  // ...
}
```
